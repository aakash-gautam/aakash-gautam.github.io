<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">

<title>TraceMatrix | AG</title>

<style>
  :root {
    --bg: #f4f7fb;
    --primary: #3f51b5;
    --good: #4caf50;
    --bad: #f44336;
    --missed: #ff9800;
  }

  body {
    margin: 0;
    font-family: "Oswald", Arial;
    background: var(--bg);
    text-align: center;
    padding: 20px;
  }

  h1 {
    color: var(--primary);
    margin-bottom: 5px;
    font-size: 3rem;
  }

  p.subtitle {
    margin: 8px auto 12px auto;
    color: #555;
    max-width: 750px;
    text-align: center;
    font-family: "Roboto", Arial;
    font-size: 1.1rem;
  }

  .controls {
    margin: 15px 0;
  }

  select, button {
    padding: 8px 12px;
    margin: 6px;
    font-size: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  button {
    background: var(--primary);
    color: #fff;
    border: none;
    cursor: pointer;
  }

  button:hover {
    opacity: 0.9;
  }

  #info {
    margin-top: 10px;
    font-weight: 600;
  }

  /* TIMER */
  #timerContainer {
    width: 80%;
    max-width: 400px;
    height: 10px;
    background: #ddd;
    border-radius: 5px;
    margin: 10px auto;
    overflow: hidden;
    display: none;
  }

  #timerBar {
    height: 100%;
    width: 100%;
    background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
    transition: width 0.1s linear;
  }

  #grid {
    display: grid;
    gap: 6px;
    justify-content: center;
    margin: 20px auto;
    max-width: 95vw;
  }

  .cell {
    background: #ddd;
    border-radius: 6px;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
  }

  .cell:hover {
    transform: scale(1.05);
  }

  .cell.active {
    background: var(--primary);
  }

  .cell.correct {
    background: #2e7d32; /* deep green */
  }

  .cell.wrong {
    background: #8e0000; /* dark red */
  }

  .cell.missed {
    background: var(--missed);
  }

  .disabled {
    pointer-events: none;
    opacity: 0.6;
  }

  #submitBtn {
    display: none;
    margin-top: 10px;
  }

  #result {
    margin-top: 20px;
    font-size: 16px;
    font-weight: bold;
  }


/* SPATIAL INTELLIGENCE OVERLAY */
#siOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

#siPopup {
  background: #fff;
  padding: 30px 25px;
  border-radius: 10px;
  width: 100%;
  max-width: 300px;
  text-align: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

#siPopup h2 {
  margin-top: 0;
  color: var(--primary);
}

#siPopup p {
  font-size: 1.1rem;
  margin: 10px 0;
}

#siPopup button {
  margin-top: 15px;
  padding: 8px 16px;
}

.si-row {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin: 6px 0;
}

</style>
</head>

<body>

<h1>üß†TraceMatrix</h1>
<p class="subtitle"><b>Focus, Remember, Recreate!</b> <br><br>
<b>TraceMatrix</b> is a simple yet engaging memory challenge designed to strengthen spatial intelligence, visual recall, and concentration. Observe patterns carefully, trust your memory, and recreate what you saw. Improve your mental mapping and cognitive flexibility in a fun & intuitive way. </p>

<div class="controls">
  Grid:
  <select id="gridSize">
    <option value="4">4 √ó 4</option>
    <option value="5" selected>5 √ó 5</option>
    <option value="6">6 √ó 6</option>
    <option value="7">7 √ó 7</option>
    <option value="8">8 √ó 8</option>
    <option value="9">9 √ó 9</option>
    <option value="10">10 √ó 10</option>
  </select>

  <br>

  Difficulty:
  <select id="difficulty">
    <option value="veryeasy">Very Easy üòå (30s)</option>
    <option value="easy">Easy üôÇ (15s)</option>
    <option value="medium" selected>Medium üòê (10s)</option>
    <option value="hard">Hard üî• (5s)</option>
  </select>

  <br> <br>

  <button onclick="startGame()">START GAME</button>
</div>

<div id="info"></div>

<!-- TIMER -->
<div id="timerContainer">
  <div id="timerBar"></div>
</div>

<div id="grid"></div>

<button id="submitBtn" onclick="submitAnswer()">Submit My Pattern</button>

<div id="result"></div>


<!-- OVERLAY POPUP -->
<div id="siOverlay" style="display:none;">
  <div id="siPopup">
    <h2>SPATIAL INTELLIGENCE INDICATOR</h2>

    <div class="si-row">
      <span id="siGrid"></span> ¬∑ <span id="siMode"></span>
    </div>

    <div class="si-row">
      <span id="siScore"></span> ¬∑ <span id="siAccuracy"></span>
    </div>

    <button onclick="closeSIOverlay()">Close</button>
  </div>
</div>

<script>
let size, highlightCount, timeLimit;
let highlighted = new Set();
let selected = new Set();
let round = 0;
let totalScore = 0;
const maxRounds = 5;
let inputLocked = false;
let gameInProgress = false;
let hideTimeout;

/* TIMER */
let timerInterval;

function startTimer(duration) {
  clearInterval(timerInterval);

  const bar = document.getElementById("timerBar");
  const container = document.getElementById("timerContainer");

  container.style.display = "block";
  let start = Date.now();

  timerInterval = setInterval(() => {
    let elapsed = Date.now() - start;
    let remaining = Math.max(0, duration - elapsed);
    let percent = (remaining / duration) * 100;
    bar.style.width = percent + "%";

    if (remaining <= 0) {
      clearInterval(timerInterval);
      container.style.display = "none";
    }
  }, 100);
}

function startGame() {
  gameInProgress = true;
  round = 0;
  totalScore = 0;
  nextRound();
}

function nextRound() {
  clearTimeout(hideTimeout);
  clearInterval(timerInterval);
  round++;
  if (round > maxRounds) {
    showFinalResult();
    return;
  }

  inputLocked = true;
  document.getElementById("result").innerHTML = "";

  size = parseInt(document.getElementById("gridSize").value);
  const difficulty = document.getElementById("difficulty").value;

  timeLimit =
        difficulty === "veryeasy" ? 30000 :
        difficulty === "easy" ? 15000 :
        difficulty === "medium" ? 10000 :
        5000;

  highlightCount = size * 2;

  createGrid();
  highlightCells();
  startTimer(timeLimit);

  document.getElementById("info").innerText =
    `Round ${round}/${maxRounds} ‚Äî Memorize the pattern üß†`;

  hideTimeout = setTimeout(hideCells, timeLimit);
}

function getCellSize() {
  const minSide = Math.min(window.innerWidth, window.innerHeight);
  return Math.floor(minSide / (size + 4));
}

function createGrid() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  highlighted.clear();
  selected.clear();

  const cellSize = getCellSize();
  grid.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;

  for (let i = 0; i < size * size; i++) {
    const cell = document.createElement("div");
    cell.className = "cell disabled";
    cell.style.width = cell.style.height = cellSize + "px";
    cell.dataset.index = i;
    cell.onclick = () => toggleSelect(cell);
    grid.appendChild(cell);
  }
}

function highlightCells() {
  while (highlighted.size < highlightCount) {
    highlighted.add(Math.floor(Math.random() * size * size));
  }

  highlighted.forEach(i => {
    document.querySelectorAll(".cell")[i].classList.add("active");
  });
}

function hideCells() {
  clearInterval(timerInterval);
  document.getElementById("timerContainer").style.display = "none";

  document.querySelectorAll(".cell").forEach(cell => {
    cell.classList.remove("active");
    cell.classList.remove("disabled");
  });

  inputLocked = false;

  document.getElementById("info").innerText =
    `Select ${highlightCount} tiles to recreate the pattern üéØ`;
}

function toggleSelect(cell) {
  if (inputLocked) return;

  const index = parseInt(cell.dataset.index);

  if (selected.has(index)) {
    selected.delete(index);
    cell.style.background = "#ddd";
    return;
  }

  if (selected.size >= highlightCount) return;

  selected.add(index);
  cell.style.background = "#90caf9";

  if (selected.size === highlightCount) {
    inputLocked = true;
    setTimeout(submitAnswer, 300);
  }
}

function getCognitiveFeedback(score) {
  if (score >= 9) return "üß† Excellent spatial recall";
  if (score >= 7) return "üëç Good pattern recognition";
  if (score >= 5) return "üôÇ Moderate recall ‚Äî stay focused";
  return "‚ö†Ô∏è Pattern confusion observed";
}

function submitAnswer() {
  document.querySelectorAll(".cell").forEach((cell, i) => {

    // üî¥ IMPORTANT: remove inline background first
    cell.style.background = "";

    if (highlighted.has(i)) {
      cell.className = "cell correct";
    }
    else if (selected.has(i)) {
      cell.className = "cell wrong";
    }
  });

  let mistakes =
    [...selected].filter(i => !highlighted.has(i)).length +
    [...highlighted].filter(i => !selected.has(i)).length;

  let score = Math.max(0, 10 - mistakes);
  totalScore += score;

  //document.getElementById("result").innerHTML =
    //`Round ${round} Score: ${score}/10<br>
     //<em>${getCognitiveFeedback(score)}</em>`;

  setTimeout(nextRound, 2500);
}


function showSIOverlay(totalScore, accuracy, gridSize, mode) {
  document.getElementById("siScore").innerText =
    `Total Score: ${totalScore} / ${maxRounds * 10}`;

  document.getElementById("siAccuracy").innerText =
    `Accuracy: ${accuracy}%`;

  document.getElementById("siGrid").innerText =
    `Grid Size: ${gridSize} √ó ${gridSize}`;

  document.getElementById("siMode").innerText =
    `Mode: ${mode.charAt(0).toUpperCase() + mode.slice(1)}`;

  document.getElementById("siOverlay").style.display = "flex";
}

function closeSIOverlay() {
  location.reload();
}


function showFinalResult() {
  const accuracy = ((totalScore / (maxRounds * 10)) * 100).toFixed(1);

  document.getElementById("info").innerText = "Session Complete üéâ";
  document.getElementById("result").innerHTML = "";

  showSIOverlay(
  totalScore,
  accuracy,
  document.getElementById("gridSize").value,
  document.getElementById("difficulty").value
);
}


function haltGameDueToSettingsChange() {
  if (!gameInProgress) return;

  // Stop timer + lock input
  clearInterval(timerInterval);
  inputLocked = true;

  // Reset game state
  gameInProgress = false;
  round = 0;
  totalScore = 0;
  highlighted.clear();
  selected.clear();

  // Clear UI and show message
  document.getElementById("timerContainer").style.display = "none";
  document.getElementById("grid").innerHTML = "";
  document.getElementById("result").innerHTML = "";
  document.getElementById("info").innerText = "‚ö†Ô∏è Settings changed. Game halted. Press START GAME to begin again.";
}

document.getElementById("gridSize").addEventListener("change", haltGameDueToSettingsChange);
document.getElementById("difficulty").addEventListener("change", haltGameDueToSettingsChange);

</script>



</body>
</html>
